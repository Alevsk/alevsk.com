---
title: '#Docker para #hackers y pentesters, ejecutando #metasploit desde un container'
author: Alevsk
type: post
date: 2016-12-24T10:01:48+00:00
url: /2016/12/docker-para-hackers-y-pentesters-ejecutando-metasploit-desde-un-container/
categories:
  - cloud
  - Geek
  - Ethical Hacking
  - Linux
  - Personal
  - Technology
  - Tips
  - Tutorials
tags:
  - containers
  - docker
  - hacking
  - Ethical Hacking
  - infosec
  - metasploit

---
[![](/images/docker-image.png)](http://www.alevsk.com/2016/10/docker-101-1-introduccion-a-docker-y-los-contenedores/docker-image/)

Se acab√≥ el 2016 y como ultima publicaci√≥n del a√±o les traigo un tutorial expr√©s que involucra docker y seguridad inform√°tica. En publicaciones anteriores explicaba que durante estos √∫ltimos meses he estado trabajando bastante con [docker][1], [orchestration][2] e infraestructura de cloud en general (parte habitual en un trabajo de full stack engineer). 

**Docker** es una herramienta muy poderosa para desarrolladores pues nos ayuda a construir im√°genes con todas sus dependencias y nos deja el paso libre para enfocarnos en lo que realmente importa: deployar r√°pidamente una aplicaci√≥n (o varias) que sabemos que va a funcionar. 

Bajo esa premisa no es de extra√±arse que la comunidad de seguridad haya adoptado **docker** tan r√°pidamente, docker es una herramienta fant√°stica üôÇ y as√≠ como nos permite [dockerizar una aplicaci√≥n][3] tambi√©n podemos dockerizar herramientas de seguridad y en general cualquier cosa que tengamos en nuestro arsenal para **pentest**.

La gente que trabaja o ha trabajado en seguridad, espec√≠ficamente en el √°rea de penetration testing, estar√° de acuerdo en que uno de los recursos m√°s importantes que tenemos son las ventanas de tiempo, por lo general cuando se realiza una prueba de penetraci√≥n a alguna aplicaci√≥n o sistema se hace durante un periodo de tiempo bien definido, el tiempo es valioso y no podemos desperdiciarlo en instalar y configurar herramientas, o peor aun ¬øque pasa si la infraestructura que estamos auditando nos bloquea? ¬øcu√°nto tiempo vamos a invertir en preparar un nuevo nodo desde donde podamos lanzar ataques y recibir shells?, para todo lo anterior llega **docker** al rescate üôÇ

En este tutorial mostrar√© como ejecutar una de las herramientas de seguridad m√°s populares utilizando docker: **metasploit**, espec√≠ficamente utilizaremos el m√≥dulo **exploit/multi/handler** para recibir sesiones de meterpreter.

_ojo: no voy a mostrar como dockerizar metasploit, eso lo dejamos para un siguiente tutorial donde veamos como [dockerizar aplicaciones][3]_

## Ejecutando metasploit desde un contenedor de docker

Para evitarte el problema de abrir los puertos en tu router y hacer un mapeo de puertos para exponer tu maquina a internet, puedes contratar un vps con alg√∫n proveedor de tu elecci√≥n, hoy en d√≠a es muy sencillo contratar un vps y puedes tener uno en l√≠nea pr√°cticamente en minutos, yo recomiendo **digitalocean** por qu√© sus vps son baratos y el soporte es muy bueno, con un nodo de **10 USD** al mes es suficiente para correr una imagen de **metasploit**, puedes contratar el de **5 USD** pero tendr√°s que habilitar el swap o si no quieres gastar dinero siempre puedes aprovechar la promoci√≥n que te ofrece [Amazon Webservices][4] (m√°s o menos 1 a√±o de uso gratuito de una instancia micro)

[![](/images/Screen-Shot-2016-12-24-at-2.32.06-AM.png)](http://www.alevsk.com/2016/12/docker-para-hackers-y-pentesters-ejecutando-metasploit-desde-un-container/screen-shot-2016-12-24-at-2-32-06-am/)

Sea cual sea el proveedor que hayas elegido el siguiente paso es [instalar docker][1] en tu instancia, para este tutorial lo har√© sobre **ubuntu** / **debian** pero podr√≠as instalarlo en el sistema operativo de tu elecci√≥n, ac√° tienes una lista de [sistemas operativos soportados][5]

Desde la terminal de tu instancia y como root vamos a ejecutar algunos comandos para instalar herramientas necesarias como compiladores de gcc/g++, algunas librer√≠as, utilidades, etc. al final vamos a instalar **docker**

```bash
apt-get install build-essential  
apt-get install libxslt-dev libxml2-dev zlib1g-dev ‚Äìyes  
apt-get install docker  
apt-get install docker.io
```

Lo siguiente que vamos a hacer es crear un directorio en nuestra instancia, este directorio lo vamos a utilizar como un volumen persistente cuando ejecutemos **metasploit** desde el contenedor para poder almacenar ah√≠ todo el **loot**, **scripts** y en general archivos que nos genere la herramienta.

```bash
mkdir /root/.msf4
```

Llego el momento, en el **docker registry** oficial existe una imagen llamada [remnux/metasploit][6] que contiene todo lo necesario para ejecutar la herramienta, ejecutamos el siguiente comando y docker comenzara a descargar la imagen y posteriormente proceder√° a correr el contenedor.

```bash
docker run ‚Äìrm -it -p 443:443 -v ~/.msf4:/root/.msf4 -v /tmp/msf:/tmp/data remnux/metasploit
```

En el [tutorial de docker anterior][7] explicaba para que era cada parametro, en resumen **-p** nos permite mapear puertos y **-v** definir vol√∫menes persistentes (mapear una carpeta de nuestro sistema de archivos a una del sistema de archivos virtual del contenedor).

Una vez la imagen haya sido descargada el contenedor ser√° creado y todas las dependencias necesarias comenzaran a ser instaladas, nos olvidamos de instalar todas las gemas y resolver conflictos y nos podemos ir por un caf√© ya que es un proceso bastante automatizo üôÇ

[![](/images/Screen-Shot-2016-12-24-at-3.04.07-AM.png)](http://www.alevsk.com/2016/12/docker-para-hackers-y-pentesters-ejecutando-metasploit-desde-un-container/screen-shot-2016-12-24-at-3-04-07-am/)
[![](/images/Screen-Shot-2016-12-24-at-3.04.41-AM.png)](http://www.alevsk.com/2016/12/docker-para-hackers-y-pentesters-ejecutando-metasploit-desde-un-container/screen-shot-2016-12-24-at-3-04-41-am/)

Despu√©s de unos minutos tenemos un nodo listo para recibir conexiones.

[![](/images/Screen-Shot-2016-12-24-at-3.10.34-AM.png)](http://www.alevsk.com/2016/12/docker-para-hackers-y-pentesters-ejecutando-metasploit-desde-un-container/screen-shot-2016-12-24-at-3-10-34-am/)
[![](/images/Screen-Shot-2016-12-24-at-3.10.45-AM.png)](http://www.alevsk.com/2016/12/docker-para-hackers-y-pentesters-ejecutando-metasploit-desde-un-container/screen-shot-2016-12-24-at-3-10-45-am/)

En el caso de necesitar m√°s listeners no hay problema pues podemos ejecutar m√∫ltiples contenedores de metasploit en diferentes puertos y as√≠ tener nuestras shells organizadas, y si nuestro servidor es baneado r√°pidamente podemos desplegar otro ejecutando esos 6 comandos.<h2conclusi√≥n< h2=""> 

Como lo he comentado en varios art√≠culos, docker es una herramienta muy poderosa que puede ser utilizada en varias situaciones adem√°s del desarrollo de software, como lo vimos en este tutorial. Puedes dockerizar casi cualquier cosa, yo en lo personal tengo una imagen con un set de herramientas que utilizo en mi d√≠a a d√≠a (fierce, dirb, sqlmap, nmap, enum4linux, hashcat, Responder, etc.)

Saludos y Happy Hacking.

 [1]: https://www.alevsk.com/2016/10/docker-101-1-introduccion-a-docker-y-los-contenedores/
 [2]: https://en.wikipedia.org/wiki/Orchestration_(computing)
 [3]: #
 [4]: https://aws.amazon.com/
 [5]: https://docs.docker.com/engine/installation/
 [6]: https://hub.docker.com/r/remnux/metasploit/
 [7]: https://www.alevsk.com/2016/10/docker-101-2-puertos-y-volumenes-de-un-contenedor/</h2conclusi√≥n<>